<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Vegetable AI Classifier</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
    <style>
      :root{--bg1:#0f172a;--card:#ffffffee;--accent1:#7c3aed;--accent2:#06b6d4}
      html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial}
      body{background:linear-gradient(180deg,#071025 0%,#071025 40%,#021024 100%);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:32px}
      .wrap{width:100%;max-width:920px}
      .hero{display:flex;gap:28px;align-items:stretch}
      .left{flex:1;background:var(--card);border-radius:16px;padding:22px;color:#0b1220;box-shadow:0 10px 40px rgba(2,6,23,0.6)}
      .right{width:380px;min-width:300px}
      h1{margin:0;font-size:28px}
      p.lead{margin:6px 0 18px;color:#334155}
      .upload{border:2px dashed #cbd5e0;border-radius:12px;padding:18px;text-align:center;cursor:pointer;background:#fafafa}
      .upload.drag{background:#f0f9ff;border-color:var(--accent2)}
      .btn{display:inline-block;padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;font-weight:700;text-decoration:none}
      img.preview{max-width:100%;border-radius:10px;display:block;margin:12px auto}
      .result{background:linear-gradient(180deg,rgba(124,58,237,0.15),rgba(6,182,212,0.06));padding:16px;border-radius:10px;color:#e6eef8}
      .bar{height:18px;background:#0b1220;border-radius:8px;overflow:hidden}
      .fill{height:100%;background:linear-gradient(90deg,var(--accent2),var(--accent1));width:0%}
      .muted{color:#94a3b8;font-size:13px}
      .footer{margin-top:18px;color:#94a3b8;font-size:13px;text-align:center}
      .bg-dot{position:fixed;border-radius:50%;opacity:.06;filter:blur(18px)}
    </style>
  </head>
  <body>
    <div class="bg-dot" style="width:260px;height:260px;left:10%;top:6%;background:linear-gradient(90deg,#06b6d4,#7c3aed)"></div>
    <div class="bg-dot" style="width:380px;height:380px;right:6%;bottom:10%;background:linear-gradient(90deg,#7c3aed,#06b6d4)"></div>

    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div>
          <h1>ü•¨ Vegetable AI Classifier</h1>
          <p class="lead">Upload gambar sayuran, sistem akan mengklasifikasikan secara otomatis menggunakan model TensorFlow.js</p>
        </div>
        <div style="text-align:right">
          <div class="muted">Model: 15 classes ‚Ä¢ Input 128x128</div>
        </div>
      </div>

      <div class="hero">
        <div class="left">
          <div id="uploadArea" class="upload" tabindex="0">
            <div id="uploadText">Klik untuk memilih atau drag & drop gambar</div>
            <input id="fileInput" type="file" accept="image/*" style="display:none">
            <img id="preview" class="preview" style="display:none">
            <div style="margin-top:8px"><a id="chooseBtn" class="btn">Pilih Gambar</a></div>
          </div>

          <div id="controls" style="margin-top:14px;display:none;gap:8px">
            <button id="predictBtn" class="btn">üîç Analisis</button>
            <button id="resetBtn" style="margin-left:8px;padding:10px 14px;border-radius:10px;background:#e6eef8;border:none;cursor:pointer">Reset</button>
          </div>

          <div id="status" style="margin-top:12px"></div>

          <div class="footer">¬© 2025 Vegetable AI Classifier | Made with ‚ù§Ô∏è</div>
        </div>

        <div class="right">
          <div class="result">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="muted">Hasil Teratas</div>
                <div id="topLabel" style="font-size:20px;font-weight:800;margin-top:6px">-</div>
              </div>
              <div id="topEmoji" style="font-size:34px">ü•¨</div>
            </div>

            <div style="margin-top:12px">
              <div class="muted">Confidence</div>
              <div class="bar" style="margin-top:6px"><div id="topBar" class="fill"></div></div>
            </div>

            <div style="margin-top:16px">
              <div class="muted">Top 5 Prediksi</div>
              <div id="top5" style="margin-top:8px"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const MODEL_PATH = 'tfjs_models/model.json';
      const IMAGE_SIZE = 128;
      const CLASS_LABELS = [
        'Bean','Bitter_Gourd','Bottle_Gourd','Brinjal','Broccoli','Cabbage','Capsicum','Carrot','Cauliflower','Cucumber','Papaya','Potato','Pumpkin','Radish','Tomato'
      ];
      const EMOJI = {Bean:'ü´ò',Bitter_Gourd:'ü•í',Bottle_Gourd:'üçà',Brinjal:'üçÜ',Broccoli:'ü•¶',Cabbage:'ü•¨',Capsicum:'ü´ë',Carrot:'ü•ï',Cauliflower:'ü•¶',Cucumber:'ü•í',Papaya:'üçà',Potato:'ü•î',Pumpkin:'üéÉ',Radish:'üå∞',Tomato:'üçÖ'};

      let model = null;
      const fileInput = document.getElementById('fileInput');
      const uploadArea = document.getElementById('uploadArea');
      const chooseBtn = document.getElementById('chooseBtn');
      const preview = document.getElementById('preview');
      const controls = document.getElementById('controls');
      const predictBtn = document.getElementById('predictBtn');
      const resetBtn = document.getElementById('resetBtn');
      const status = document.getElementById('status');
      const topLabel = document.getElementById('topLabel');
      const topEmoji = document.getElementById('topEmoji');
      const topBar = document.getElementById('topBar');
      const top5 = document.getElementById('top5');

      async function init(){
        setStatus('Memuat model...');
        try{
          model = await tf.loadLayersModel(MODEL_PATH);
          // warmup
          const dummy = tf.zeros([1,IMAGE_SIZE,IMAGE_SIZE,3]);
          model.predict(dummy).dispose();
          dummy.dispose();
          setStatus('Model siap ‚úîÔ∏è');
        }catch(err){
          console.error(err);
          setStatus('‚ùå Gagal memuat model. Pastikan folder tfjs_models tersedia dan berisi model.json serta shard files. Cek DevTools -> Network.');
        }
      }

      function setStatus(txt){status.innerHTML = '<div class="muted">'+txt+'</div>'}

      chooseBtn.addEventListener('click',()=>fileInput.click());
      uploadArea.addEventListener('click',()=>fileInput.click());
      fileInput.addEventListener('change',(e)=>{handleFile(e.target.files[0])});

      uploadArea.addEventListener('dragover',(e)=>{e.preventDefault();uploadArea.classList.add('drag')});
      uploadArea.addEventListener('dragleave',(e)=>{e.preventDefault();uploadArea.classList.remove('drag')});
      uploadArea.addEventListener('drop',(e)=>{e.preventDefault();uploadArea.classList.remove('drag');handleFile(e.dataTransfer.files[0])});

      function handleFile(file){
        if(!file) return;
        if(!file.type.startsWith('image/')){alert('Mohon pilih file gambar');return}
        const reader=new FileReader();
        reader.onload=function(ev){
          preview.src = ev.target.result; preview.style.display='block'; controls.style.display='flex'; setStatus('Gambar siap. Tekan Analisis.');
        };
        reader.readAsDataURL(file);
      }

      resetBtn.addEventListener('click',()=>{preview.src='';preview.style.display='none';controls.style.display='none'; topLabel.textContent='-'; topEmoji.textContent='ü•¨'; topBar.style.width='0%'; top5.innerHTML=''; setStatus('')});

      predictBtn.addEventListener('click',async ()=>{
        if(!model){alert('Model belum siap');return}
        if(!preview.src){alert('Pilih gambar terlebih dahulu');return}

        setStatus('Menganalisis...');
        try{
          const img = new Image(); img.src = preview.src; await new Promise(r=>img.onload=r);
          let tensor = tf.browser.fromPixels(img).resizeBilinear([IMAGE_SIZE,IMAGE_SIZE]).toFloat().div(255.0).expandDims(0);
          const preds = model.predict(tensor);
          const data = await preds.data();
          tensor.dispose(); if(preds.dispose) preds.dispose();

          const arr = Array.from(data).map((p,i)=>({label:CLASS_LABELS[i].replace(/_/g,' '),prob:p})); arr.sort((a,b)=>b.prob-a.prob);
          const top = arr.slice(0,5);

          topLabel.textContent = top[0].label;
          topEmoji.textContent = EMOJI[top[0].label.replace(/ /g,'_')] || 'ü•¨';
          topBar.style.width = Math.round(top[0].prob*100) + '%';

          top5.innerHTML = '';
          top.forEach(t=>{
            const row = document.createElement('div'); row.style.display='flex';row.style.justifyContent='space-between';row.style.alignItems='center';row.style.marginTop='8px';
            const left = document.createElement('div'); left.textContent = (EMOJI[t.label.replace(/ /g,'_')]||'') + ' ' + t.label; left.style.fontWeight='600';
            const right = document.createElement('div'); right.textContent = Math.round(t.prob*100) + '%'; right.style.opacity='0.9';
            row.appendChild(left); row.appendChild(right); top5.appendChild(row);
            const barWrap = document.createElement('div'); barWrap.className='bar'; barWrap.style.marginTop='6px'; const f = document.createElement('div'); f.className='fill'; f.style.width = '0%'; barWrap.appendChild(f); top5.appendChild(barWrap);
            setTimeout(()=>{f.style.width = Math.round(t.prob*100) + '%'},100);
          })

          setStatus('Selesai');
        }catch(err){console.error(err); setStatus('‚ùå Gagal menganalisis gambar')}
      });

      init();
    </script>
  </body>
</html>